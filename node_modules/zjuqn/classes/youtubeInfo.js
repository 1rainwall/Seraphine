const Discord = require('discord.js')
const fetch = require('node-fetch')
const {zJuqnError} = require('../Util/zJuqnError')
   /**
   * @param {Discord.Message} options.message
   * @param {Discord.ColorResolvable} options.color 
   * @param {String} options.channelName
  */

  class youtubeChannelInfo {

   constructor(options) {
    if (!options.color) throw new zJuqnError('[ERROR] => Error: Falta el color en el argumento de la función de youtubeChannelInfo.')
    if (typeof options.color !== 'string') throw new zJuqnError('[ERROR] => Error: ¡El color debe ser un String! en la función de youtubeChannelInfo.')
    if (!options.channelName) throw new zJuqnError('[ERROR] => Error: Falta el argumento channelName en la funcion youtubeChannelInfo')
    if (typeof options.channelName !== 'string') throw new zJuqnError('[ERROR] => Error: ¡El nombre del channelName debe ser un String! en la función de youtubeChannelInfo.')
    if (!options.message) throw new zJuqnError('[ERROR] => Error: Falta el mensaje donde se enviara el embed')

    this.message = options.message
    this.color = options.color
    this.channelName = options.channelName

   }

   async send() {
    try {
        let yt = await fetch(`https://suggy.sugger25.repl.co/api/youtube?channel=${this.channelName.replace(" ", "+")}`)
        .then(res => res.json())
        const embed = new Discord.MessageEmbed()

        .setTitle(`Estadistica del canal: ${yt.name}`)
        .setDescription(`Nombre del canal: **${yt.name}**\nDescripcion del canal: **${yt.description}**`)
        .addField("Subscriptores actuales:", `${yt.subscribers}.`, true)
        .addField("Vistas totales del canal:", `${yt.views}.`, true)
        .addField("Region del canal:", `${yt.country}.`, true)
        .addField("Canal Creado el:", `${yt.createdAt}.`)
        .setURL(yt.url)
        .addField("Links:", `[Icono](${yt.icon}) | [Banner](${yt.banner}) | [CanalURL](${yt.url})`)
        .setColor(this.color)



        return this.message.reply({embeds: [embed]}).catch()

    } catch(err) {
      this.message.reply({ embeds: [new Discord.MessageEmbed().setColor("RED").setDescription(":x: `|` No se encontraron resultados para el canal de YouTube que ingresate")]})
    }
   }
}

module.exports = youtubeChannelInfo